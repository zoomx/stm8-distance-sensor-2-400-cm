//
// Hi-Tech Lite include file for DB038 board with 16F887:
// using an (external) RFM70 transciever
//
// Loosely based on the example application provided by HopeRF
//
//
// $Id: rfm70-config.h,v 1.1 2011/12/24 13:47:23 Wouter Exp $
//
// (c) Wouter van Ooijen - wouter@voti.nl
//
// Copying and distribution of this file, with or without modification,
// are permitted in any medium without royalty provided the copyright
// notice and this notice are preserved.  This file is offered as-is,
// without any warranty.
//

#ifndef _STM8SVLDIS_RFM70_H_
#define _STM8SVLDIS_RFM70_H_

#include "stm8s.h"

/*
PB0 - SCK  - OUT
PB1 - MOSI - OUT
PB2 - MISO - IN
PB3 - CSN  - OUT
PB4 - CE   - OUT
*/

#define RFM70_SCK( x )   ((x == 1) ? GPIOB->ODR |= 0x01 : GPIOB->ODR &= ~0x01) 
#define RFM70_MOSI( x )  ((x == 1) ? GPIOB->ODR |= 0x02 : GPIOB->ODR &= ~0x02) 
#define RFM70_MISO       (GPIOB->IDR & 0x04)                               
#define RFM70_CSN( x )   ((x == 1) ? GPIOB->ODR |= 0x08 : GPIOB->ODR &= ~0x08)
#define RFM70_CE( x )    ((x == 1) ? GPIOB->ODR |= 0x10 : GPIOB->ODR &= ~0x10)

#define RFM70_PIN_DIRECTION { \
  GPIO_Init(GPIOB, GPIO_PIN_0, GPIO_MODE_OUT_PP_LOW_FAST); \
  GPIO_Init(GPIOB, GPIO_PIN_1, GPIO_MODE_OUT_PP_LOW_FAST); \
  GPIO_Init(GPIOB, GPIO_PIN_2, GPIO_MODE_IN_FL_NO_IT);     \
  GPIO_Init(GPIOB, GPIO_PIN_3, GPIO_MODE_OUT_PP_LOW_FAST); \
  GPIO_Init(GPIOB, GPIO_PIN_4, GPIO_MODE_OUT_PP_LOW_FAST); \
}

#define WAIT_50MS { \
  while(DELAY_50MS_FLAG == FALSE);  \
  DELAY_50MS_FLAG = FALSE;          \
}

#define WAIT_1US { \     /* @ 16MHz clock */
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
  asm {"nop"};     \
}
#define WAIT_US (x) { \
  while(x--)          \
  {                   \
    WAIT_1US;         \
  }                   \
}
//#define RFM70_WAIT_US( x ) WAIT_US( x )
//#define RFM70_WAIT_MS( x ) WAIT_MS( x )

#include "rfm70.h"

#endif